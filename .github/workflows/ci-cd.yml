name: CI-CD Pipeline

on:
  push:
    branches:
      - TESTES
  pull_request:
    branches:
      - TESTES

jobs:
  prepare:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2

  install_dependencies:
    runs-on: ubuntu-latest
    needs: prepare
    steps:
      - name: Check out code
        uses: actions/checkout@v2
      
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'
          
      - name: Install dependencies
        run: |
         cd sample-nodejs-app
         npm install

  build:
    runs-on: ubuntu-latest
    needs: install_dependencies
    steps:
      - name: Check out code
        uses: actions/checkout@v2
      - name: Build application
        run: |
         cd sample-nodejs-app
         npm run build


  sonar_scan:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Check out code
        uses: actions/checkout@v2
      - name: Run SonarQube Scan
        uses: SonarSource/sonarcloud-github-action@v1.11
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_PROJECTKEY: Vmoralles_first-pipeline
          SONAR_ORGANIZATION: vmoralles
          SONAR_HOST_URL: https://sonarcloud.io}
